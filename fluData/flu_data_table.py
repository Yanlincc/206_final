import sqlite3
from fluData.get_flu_data import get_flu_data
def create_flu_table():
    conn = sqlite3.connect('./database.db')

    cursor = conn.cursor()

    create_table_query = '''
        CREATE TABLE IF NOT EXISTS flu_data (
            state TEXT NOT NULL,
            quarter TEXT NOT NULL,
            num_patients REAL,
            PRIMARY KEY (state, quarter)
        )
    '''

    cursor.execute(create_table_query)

    conn.commit()
    conn.close()

def insert_flu_data(state, q, num_patients):
    conn = sqlite3.connect('./database.db')
    cursor = conn.cursor()
    cursor.execute('''
        INSERT OR REPLACE INTO flu_data (state, quarter, num_patients)
        VALUES (?, ?, ?)
    ''', (state, q, num_patients,))
    conn.commit()
    conn.close()

def construct_flu_table():
    data = get_flu_data()
    #data = {'al': {'Q1': 620580, 'Q2': 578483, 'Q3': 670570, 'Q4': 605973}, 'ak': {'Q1': 45497, 'Q2': 41647, 'Q3': 46355, 'Q4': 48510}, 'az': {'Q1': 135118, 'Q2': 123411, 'Q3': 124022, 'Q4': 265074}, 'ar': {'Q1': 207592, 'Q2': 181854, 'Q3': 168474, 'Q4': 201368}, 'ca': {'Q1': 1528504, 'Q2': 1451266, 'Q3': 1437472, 'Q4': 3456325}, 'co': {'Q1': 545713, 'Q2': 527565, 'Q3': 536906, 'Q4': 595892}, 'ct': {'Q1': 521199, 'Q2': 536247, 'Q3': 535150, 'Q4': 569996}, 'de': {'Q1': 112224, 'Q2': 123571, 'Q3': 113149, 'Q4': 171235}, 'fl': {'Q1': 3021405, 'Q2': 3017391, 'Q3': 2870001, 'Q4': 3036749}, 'ga': {'Q1': 950713, 'Q2': 936801, 'Q3': 993046, 'Q4': 968013}, 'hi': {'Q1': 25829, 'Q2': 28103, 'Q3': 32053, 'Q4': 377103}, 'id': {'Q1': 117488, 'Q2': 110305, 'Q3': 113415, 'Q4': 115694}, 'il': {'Q1': 910094, 'Q2': 883926, 'Q3': 867562, 'Q4': 933511}, 'in': {'Q1': 636188, 'Q2': 638551, 'Q3': 656234, 'Q4': 696578}, 'ia': {'Q1': 61475, 'Q2': 55287, 'Q3': 56128, 'Q4': 63291}, 'ks': {'Q1': 152977, 'Q2': 106049, 'Q3': 113671, 'Q4': 219927}, 'ky': {'Q1': 466017, 'Q2': 422158, 'Q3': 423477, 'Q4': 418516}, 'la': {'Q1': 518455, 'Q2': 507953, 'Q3': 533344, 'Q4': 541689}, 'me': {'Q1': 172393, 'Q2': 184210, 'Q3': 189430, 'Q4': 186298}, 'md': {'Q1': 535082, 'Q2': 533854, 'Q3': 517925, 'Q4': 533889}, 'ma': {'Q1': 826236, 'Q2': 849265, 'Q3': 851783, 'Q4': 977201}, 'mi': {'Q1': 910456, 'Q2': 994351, 'Q3': 1055761, 'Q4': 1055226}, 'mn': {'Q1': 462466, 'Q2': 393399, 'Q3': 376838, 'Q4': 407595}, 'ms': {'Q1': 164257, 'Q2': 147674, 'Q3': 155144, 'Q4': 162645}, 'mo': {'Q1': 333227, 'Q2': 327160, 'Q3': 339985, 'Q4': 359233}, 'mt': {'Q1': 83912, 'Q2': 85249, 'Q3': 90547, 'Q4': 86903}, 'ne': {'Q1': 174742, 'Q2': 162511, 'Q3': 175153, 'Q4': 200407}, 'nv': {'Q1': 138718, 'Q2': 128233, 'Q3': 131926, 'Q4': 237734}, 'nh': {'Q1': 16587, 'Q2': 16498, 'Q3': 12457, 'Q4': 16895}, 'nj': {'Q1': 328253, 'Q2': 350997, 'Q3': 349049, 'Q4': 365069}, 'nm': {'Q1': 258485, 'Q2': 258980, 'Q3': 265058, 'Q4': 284533}, 'ny': {'Q1': 1536113, 'Q2': 1595670, 'Q3': 1586031, 'Q4': 2133151}, 'nc': {'Q1': 1144940, 'Q2': 1113913, 'Q3': 1075389, 'Q4': 1148600}, 'nd': {'Q1': 37885, 'Q2': 35304, 'Q3': 38751, 'Q4': 44298}, 'oh': {'Q1': 525866, 'Q2': 495873, 'Q3': 481904, 'Q4': 529352}, 'ok': {'Q1': 140491, 'Q2': 217370, 'Q3': 203708, 'Q4': 228040}, 'or': {'Q1': 487163, 'Q2': 495108, 'Q3': 479135, 'Q4': 507635}, 'pa': {'Q1': 792259, 'Q2': 795356, 'Q3': 798631, 'Q4': 832865}, 'ri': {'Q1': 143559, 'Q2': 148252, 'Q3': 151803, 'Q4': 163192}, 'sc': {'Q1': 427372, 'Q2': 399247, 'Q3': 389294, 'Q4': 401230}, 'sd': {'Q1': 112206, 'Q2': 99115, 'Q3': 109864, 'Q4': 107832}, 'tn': {'Q1': 427981, 'Q2': 419782, 'Q3': 426240, 'Q4': 436797}, 'tx': {'Q1': 655257, 'Q2': 774153, 'Q3': 611851, 'Q4': 681428}, 'ut': {'Q1': 231127, 'Q2': 192991, 'Q3': 215659, 'Q4': 239239}, 'vt': {'Q1': 66970, 'Q2': 67389, 'Q3': 57924, 'Q4': 65164}, 'va': {'Q1': 1224557, 'Q2': 1291036, 'Q3': 1319240, 'Q4': 1320695}, 'wa': {'Q1': 442916, 'Q2': 445489, 'Q3': 435852, 'Q4': 530107}, 'wv': {'Q1': 160717, 'Q2': 106306, 'Q3': 108412, 'Q4': 156384}, 'wi': {'Q1': 240788, 'Q2': 245924, 'Q3': 250506, 'Q4': 258657}, 'wy': {'Q1': 38096, 'Q2': 25351, 'Q3': 26139, 'Q4': 38377}}
    create_flu_table()
    print(data)
    if data is None:
        return
    for i, j in data.items():
        for n, v in j.items():
            insert_flu_data(i, n, v)
